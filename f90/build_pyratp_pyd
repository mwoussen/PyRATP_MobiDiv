# création pyratp.pyf
# ATTENTION les fichiers doivent avoir le même encodage que celui de la machine (généralement utf-8)
# vim +"set nobomb | set fenc=utf-8 | x" file.txt
# ou alors iconv -f ISO-8859-1 -t UTF-8 in.txt > out.txt
f2py -m pyratp --overwrite-signature -h pyratp.pyf mod_Cocnstant_ValuesF2PY.f90 mod_Grid3DF2PY_64bit.f90 mod_SkyvaultF2PY.f90 mod_Vegetation_TypesF2PY.f90 mod_Dir_InterceptionF2PY.f90 mod_Hemi_InterceptionF2PY.f90 mod_MicrometeoF2PY.f90 mod_Shortwave_BalanceF2PY.f90 mod_Energy_BalanceF2PY.f90 mod_PhotosynthesisF2PY.f90 mod_MinerPhenoF2PY.f90 prog_RATP.f90

# premiere compilation
f2py -c --build-dir . --compiler=mingw32 --fcompiler=gnu95 pyratp.pyf mod_Cocnstant_ValuesF2PY.f90 mod_Grid3DF2PY_64bit.f90 mod_SkyvaultF2PY.f90 mod_Vegetation_TypesF2PY.f90 mod_Dir_InterceptionF2PY.f90 mod_Hemi_InterceptionF2PY.f90 mod_MicrometeoF2PY.f90 mod_Shortwave_BalanceF2PY.f90 mod_Energy_BalanceF2PY.f90 mod_PhotosynthesisF2PY.f90 mod_MinerPhenoF2PY.f90 prog_RATP.f90

# remplace la lib
#include <setjmp.h> -> #include <setjmpex.h>

# f2py -c again

# construit pyratp.pyd
gfortran -Wall -g -shared .\Release\src.win-amd64-3.7\pyratpmodule.o .\Release\src.win-amd64-3.7\src.win-amd64-3.7\fortranobject.o .\Release\mod_Cocnstant_ValuesF2PY.o .\Release\mod_Grid3DF2PY_64bit.o .\Release\mod_SkyvaultF2PY.o .\Release\mod_Vegetation_TypesF2PY.o .\Release\mod_Dir_InterceptionF2PY.o .\Release\mod_Hemi_InterceptionF2PY.o .\Release\mod_MicrometeoF2PY.o .\Release\mod_Shortwave_BalanceF2PY.o .\Release\mod_Energy_BalanceF2PY.o .\Release\mod_PhotosynthesisF2PY.o .\Release\mod_MinerPhenoF2PY.o .\Release\prog_RATP.o .\Release\src.win-amd64-3.7\pyratp-f2pywrappers2.o -L"C:\Program Files\mingw-w64\x86_64-8.1.0-posix-seh-rt_v6-rev0\mingw64\lib\gcc\x86_64-w64-mingw32\8.1.0" -L"C:\Users\mwoussen\Anaconda3\envs\pyratp37\libs" -L"C:\Users\mwoussen\Anaconda3\envs\pyratp37\PCBuild\amd64" -lpython37 -lgfortran -o .\pyratp.pyd

# copie de la librairie
cp .\pyratp.pyd ..\pyratp\
